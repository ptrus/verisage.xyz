services:
  server:
    image: docker.io/ptrusr/verisage:latest@sha256:9bba64fcbd9107c94121b68649b31d66c38ecc655e833e3f06b012c38387c928
    container_name: verisage-server
    command: ./start-server.sh
    ports:
      - "8000:8000"
    annotations:
      net.oasis.proxy.ports.8000.custom_domain: api.verisage.xyz
    environment:
      - ENVIRONMENT=${ENVIRONMENT:-production}
      - DEBUG_MOCK=${DEBUG_MOCK:-false}
      - DEBUG_PAYMENTS=${DEBUG_PAYMENTS:-false}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000}
      - X402_PAYMENT_ADDRESS=${X402_PAYMENT_ADDRESS}
      - X402_NETWORK=${X402_NETWORK:-base-sepolia}
      - X402_PRICE=${X402_PRICE:-$0.1}
      - CDP_API_KEY_ID=${CDP_API_KEY_ID:-}
      - CDP_API_KEY_SECRET=${CDP_API_KEY_SECRET:-}
      - DATA_DIR=/app/data
    volumes:
      - db-data:/app/data
    restart: unless-stopped
  worker:
    image: docker.io/ptrusr/verisage:latest@sha256:9bba64fcbd9107c94121b68649b31d66c38ecc655e833e3f06b012c38387c928
    container_name: verisage-worker
    command: ./start-worker.sh
    environment:
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - DEBUG_MOCK=${DEBUG_MOCK:-false}
      - DEBUG_SIGNING=${DEBUG_SIGNING:-false}
      - CLAUDE_API_KEY=${CLAUDE_API_KEY:-mock-key}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-mock-key}
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY:-mock-key}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-mock-key}
      - DATA_DIR=/app/data
    volumes:
      - db-data:/app/data
    restart: unless-stopped
volumes:
  db-data:
