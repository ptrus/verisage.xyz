services:
  server:
    image: ghcr.io/ptrus/verisage.xyz:latest@sha256:db183ea3ac77267da40c41a34c340b561a48c165887a3ef13655a5eca0bdfea5
    container_name: verisage-server
    command: ./start-server.sh
    ports:
      - "8000:8000"
    annotations:
      net.oasis.proxy.ports.8000.custom_domain: api.verisage.xyz
    environment:
      - PROCESS_TYPE=server
      - ENVIRONMENT=${ENVIRONMENT:-production}
      - DEBUG_MOCK=${DEBUG_MOCK:-false}
      - DEBUG_PAYMENTS=${DEBUG_PAYMENTS:-false}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000}
      - X402_PAYMENT_ADDRESS=${X402_PAYMENT_ADDRESS:-}
      - X402_NETWORK=${X402_NETWORK:-base-sepolia}
      - X402_PRICE=${X402_PRICE:-$0.1}
      - CDP_API_KEY_ID=${CDP_API_KEY_ID:-}
      - CDP_API_KEY_SECRET=${CDP_API_KEY_SECRET:-}
      - FACILITATOR_URL=${FACILITATOR_URL:-}
      - AGENT0_CHAIN_ID=${AGENT0_CHAIN_ID:-84532}
      - AGENT0_RPC_URL=${AGENT0_RPC_URL:-}
      - AGENT0_PRIVATE_KEY=${AGENT0_PRIVATE_KEY:-}
      - AGENT0_IPFS_PROVIDER=${AGENT0_IPFS_PROVIDER:-pinata}
      - AGENT0_PINATA_JWT=${AGENT0_PINATA_JWT:-}
      - AGENT0_WALLET_ADDRESS=${AGENT0_WALLET_ADDRESS:-}
      - AGENT0_FORCE_REREGISTER=${AGENT0_FORCE_REREGISTER:-false}
      - DATA_DIR=/app/data
    volumes:
      - /run/rofl-appd.sock:/run/rofl-appd.sock
      - db-data:/app/data
    restart: unless-stopped
  worker:
    image: ghcr.io/ptrus/verisage.xyz:latest@sha256:db183ea3ac77267da40c41a34c340b561a48c165887a3ef13655a5eca0bdfea5
    container_name: verisage-worker
    command: ./start-worker.sh
    environment:
      - PROCESS_TYPE=worker
      - ENVIRONMENT=${ENVIRONMENT:-production}
      - DEBUG_MOCK=${DEBUG_MOCK:-false}
      - DEBUG_SIGNING=${DEBUG_SIGNING:-false}
      - CLAUDE_API_KEY=${CLAUDE_API_KEY:-}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - DATA_DIR=/app/data
    volumes:
      - /run/rofl-appd.sock:/run/rofl-appd.sock
      - db-data:/app/data
    restart: unless-stopped
volumes:
  db-data:
